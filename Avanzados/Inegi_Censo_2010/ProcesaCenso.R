#Procesar censo 2010


setwd("C:/Users/Stephane/Desktop/Coursera/Geocoding/Censo2010/")
filenames <- character(32)
url <- "http://www.inegi.org.mx/sistemas/consulta_resultados/zip/RESAGEBURB/"
for(i in 1:32){
  if(i<10){
    filenames[i] <- paste("RESAGEBURB_0",i,"txt10.txt",sep="",collapse="")
  }
  else{
    filenames[i] <- paste("RESAGEBURB_",i,"txt10.txt",sep="", collapse="")
  }
}
for(i in seq_along(filenames)){
  filepath <- paste(url,filenames[i],".zip",sep="", collapse="")
  download.file(filepath,paste("./Comprimidos/",filenames[i],".zip",sep="", collapse=""))
}
for(i in seq_along(filenames)){
  filepath <- paste("./Comprimidos/",filenames[i],".zip",sep="", collapse="")
  unzip(filepath)
}


columndatatype <- rep("character",8)
columndatatype <- c(columndatatype,rep("numeric",190))
 datalist <- list()
tmp <- lapply(filenames,read.table, header = TRUE, sep = "\t",colClasses = columndatatype, na.strings = c("*","N/D"))
str(tmp)
censo2010 <- do.call(rbind,tmp)

for(i in seq_along(filenames)){
  datalist[i] <- read.table(paste(filenames[i],".txt",sep = "",collapse = ""),header = TRUE, sep = "\t",colClasses = columndatatype, na.strings = c("*","N/D"))
}
str(datalist)
head(censo2010[which(censo2010$ENTIDAD == "15"),]) 


head(censo2010,40)
str(censo2010)
unique(censo2010$NOM_LOC)
censo2010_Municipios <- censo2010[which(censo2010$NOM_LOC %in% c("Total del municipio","Total del Municipio")),]
nrow(censo2010_Municipios)
sum(censo2010_Municipios$POBTOT)
censo2010_Municipios_mas50000 <- censo2010_Municipios[which(censo2010_Municipios$POBTOT >= 50000),]
nrow(censo2010_Municipios_mas50000)
sum(censo2010_Municipios_mas50000$POBTOT)
censo2010_Municipios_mas50000[which(censo2010_Municipios_mas50000$ENTIDAD == "01"),]
censo2010_Municipios[which(censo2010_Municipios$ENTIDAD == "01"),]
censo2010_Municipios_mas50000$MUN_ID <- paste(censo2010_Municipios_mas50000$ENTIDAD,censo2010_Municipios_mas50000$MUN,sep = "")
names(censo2010_Municipios_mas50000)
write.csv(censo2010_Municipios_mas50000[,c(200,2,4)],"municpios_50000.csv",row.names = FALSE)

73417035/112336538

censo2010_LOCALIDADES <- censo2010[which(censo2010$NOM_LOC == "Total de la localidad urbana"),]
nrow(censo2010_LOCALIDADES)
head(censo2010_LOCALIDADES)
sum(censo2010_LOCALIDADES$POBTOT)
censo2010_Localidades_mas50000 <- censo2010_LOCALIDADES[which(censo2010_LOCALIDADES$POBTOT >= 50000),]
nrow(censo2010_Localidades_mas50000)
sum(censo2010_Localidades_mas50000$POBTOT)
censo2010_Localidades_mas50000[which(censo2010_Localidades_mas50000$ENTIDAD == 15),] 

head(censo2010_Localidades_mas50000)


censo2010_AGEBS <- censo2010[which(censo2010$NOM_LOC == "Total AGEB urbana"),]
str(censo2010_AGEBS)
head(censo2010_AGEBS)
names(censo2010_AGEBS)
columnstokeep <- c("ENTIDAD","NOM_ENT","MUN","NOM_MUN","LOC","NOM_LOC","AGEB","POBTOT","P_18YMAS","P18YM_PB","GRAPROES","VIVTOT","TVIVPAR","VIVPAR_HAB","TVIVPARHAB","VPH_PISODT","VPH_PISOTI","OCUPVIVPAR","PRO_OCUP_C","PROM_OCUP","VPH_TV","VPH_AUTOM","VPH_PC","VPH_INTER")
censo2010_AGEBS_FINAL <- censo2010_AGEBS[,columnstokeep]
str(censo2010_AGEBS_FINAL)
nrow(censo2010_AGEBS_FINAL)
head(censo2010_AGEBS_FINAL)
censo2010_AGEBS_FINAL$AGEB_ID <- paste(censo2010_AGEBS_FINAL$ENTIDAD,censo2010_AGEBS_FINAL$MUN,censo2010_AGEBS_FINAL$LOC,censo2010_AGEBS_FINAL$AGEB,sep = "")
censo2010_AGEBS_FINAL$MUN_ID <- paste(censo2010_AGEBS_FINAL$ENTIDAD,censo2010_AGEBS_FINAL$MUN,sep = "")
head(censo2010_AGEBS_FINAL)
sum(censo2010_AGEBS_FINAL[which(censo2010_AGEBS_FINAL$MUN_ID %in% MUNICIPIO),]$POBTOT)
MUNICIPIO <- c(censo2010_Municipios_mas50000$MUN_ID,"19049")
censo2010_AGEBS_FINAL <- censo2010_AGEBS_FINAL[which(censo2010_AGEBS_FINAL$MUN_ID %in% MUNICIPIO),]

##paste(names(censo2010_AGEBS_FINAL),collapse = "\",\"")
str(censo2010_AGEBS_FINAL)
censo2010_AGEBS_FINAL <- censo2010_AGEBS_FINAL[,names(censo2010_AGEBS_FINAL)[c(25,1:24)]]

##No correr
censo2010_AGEBS_FINAL$Indice_PC <- censo2010_AGEBS_FINAL$VPH_PC/censo2010_AGEBS_FINAL$VIVPAR_HAB
hist(censo2010_AGEBS_FINAL$Indice_PC)
boxplot(censo2010_AGEBS_FINAL$Indice_PC)
summary(censo2010_AGEBS_FINAL$GRAPROES)


nrow(censo2010_AGEBS_FINAL[which(censo2010_AGEBS_FINAL$GRAPROES == 18),])
maximogrado <- max(censo2010_AGEBS_FINAL$GRAPROES)
censo2010_AGEBS_FINAL$Indice_ESC <- censo2010_AGEBS_FINAL$GRAPROES/maximogrado
hist(censo2010_AGEBS_FINAL$Indice_ESC)
boxplot(censo2010_AGEBS_FINAL$Indice_ESC)
head(censo2010_AGEBS_FINAL[order(censo2010_AGEBS_FINAL[,24]),c(1,24)])

censo2010_AGEBS_FINAL$Indice_EDUSUP <- censo2010_AGEBS_FINAL$P18YM_PB/censo2010_AGEBS_FINAL$P_18YMAS


censo2010_AGEBS_FINAL$Indice_PC <- censo2010_AGEBS_FINAL$VPH_PC/censo2010_AGEBS_FINAL$VIVPAR_HAB

censo2010_AGEBS_FINAL$Indice_AUTOM <- censo2010_AGEBS_FINAL$VPH_AUTOM/censo2010_AGEBS_FINAL$VIVPAR_HAB

censo2010_AGEBS_FINAL$PROMCUARTOS <- censo2010_AGEBS_FINAL$PROM_OCUP/censo2010_AGEBS_FINAL$PRO_OCUP_C
##Todas las div 0 a 0
censo2010_AGEBS_FINAL[which(censo2010_AGEBS_FINAL$PROMCUARTOS > 16),]$PROMCUARTOS <- 0


maximocuartos <- max(censo2010_AGEBS_FINAL$PROMCUARTOS, na.rm =TRUE)
summary(censo2010_AGEBS_FINAL$PROMCUARTOS)
maximocuartos <- max(censo2010_AGEBS_FINAL[which(censo2010_AGEBS_FINAL$PROMCUARTOS < 16),]$PROMCUARTOS)


censo2010_AGEBS_FINAL$Indice_CUARTOS <- censo2010_AGEBS_FINAL$PROMCUARTOS/maximocuartos

censo2010_AGEBS_FINAL$Indice_PISONOTIERRA <- censo2010_AGEBS_FINAL$VPH_PISODT/censo2010_AGEBS_FINAL$VIVPAR_HAB

censo2010_AGEBS_FINAL$Indice_INTER <- censo2010_AGEBS_FINAL$VPH_INTER/censo2010_AGEBS_FINAL$VIVPAR_HAB


censo2010_AGEBS_FINAL[order(censo2010_AGEBS_FINAL$Indice_INTER, decreasing = TRUE),]

censo2010_AGEBS_FINAL_NARM <- censo2010_AGEBS_FINAL

?rowsum

##Tecnica 1 - remplazar con las means
censo2010_AGEBS_FINAL_NARM[which(is.na(censo2010_AGEBS_FINAL_NARM$Indice_EDUSUP)),]$Indice_EDUSUP <- mean(censo2010_AGEBS_FINAL_NARM$Indice_EDUSUP,na.rm =TRUE)
censo2010_AGEBS_FINAL_NARM[which(is.na(censo2010_AGEBS_FINAL_NARM$Indice_PC)),]$Indice_PC <- mean(censo2010_AGEBS_FINAL_NARM$Indice_PC,na.rm =TRUE)
censo2010_AGEBS_FINAL_NARM[which(is.na(censo2010_AGEBS_FINAL_NARM$Indice_AUTOM)),]$Indice_AUTOM <- mean(censo2010_AGEBS_FINAL_NARM$Indice_AUTOM,na.rm =TRUE)
censo2010_AGEBS_FINAL_NARM[which(is.na(censo2010_AGEBS_FINAL_NARM$Indice_CUARTOS)),]$Indice_CUARTOS <- mean(censo2010_AGEBS_FINAL_NARM$Indice_CUARTOS,na.rm =TRUE)
censo2010_AGEBS_FINAL_NARM[which(is.na(censo2010_AGEBS_FINAL_NARM$Indice_PISONOTIERRA)),]$Indice_PISONOTIERRA <- mean(censo2010_AGEBS_FINAL_NARM$Indice_PISONOTIERRA,na.rm =TRUE)
censo2010_AGEBS_FINAL_NARM[which(is.na(censo2010_AGEBS_FINAL_NARM$Indice_INTER)),]$Indice_INTER <- mean(censo2010_AGEBS_FINAL_NARM$Indice_INTER,na.rm =TRUE)

#Tecnica 2 - remplazar con 0´s
censo2010_AGEBS_FINAL_NARM[which(is.na(censo2010_AGEBS_FINAL_NARM$Indice_EDUSUP)),]$Indice_EDUSUP <- 0
censo2010_AGEBS_FINAL_NARM[which(is.na(censo2010_AGEBS_FINAL_NARM$Indice_PC)),]$Indice_PC <- 0
censo2010_AGEBS_FINAL_NARM[which(is.na(censo2010_AGEBS_FINAL_NARM$Indice_AUTOM)),]$Indice_AUTOM <- 0
censo2010_AGEBS_FINAL_NARM[which(is.na(censo2010_AGEBS_FINAL_NARM$Indice_CUARTOS)),]$Indice_CUARTOS <- 0
censo2010_AGEBS_FINAL_NARM[which(is.na(censo2010_AGEBS_FINAL_NARM$Indice_PISONOTIERRA)),]$Indice_PISONOTIERRA <- 0
censo2010_AGEBS_FINAL_NARM[which(is.na(censo2010_AGEBS_FINAL_NARM$Indice_INTER)),]$Indice_INTER <- 0

names(censo2010_AGEBS_FINAL_NARM)
censo2010_AGEBS_FINAL_NARM$pruebaindiceglobal <- rowSums(censo2010_AGEBS_FINAL_NARM[,c(27,28,29,30,32,33,34)])

censo2010_AGEBS_FINAL_NARM[which(is.na(censo2010_AGEBS_FINAL_NARM$pruebaindiceglobal)),]

censo2010_AGEBS_FINAL_NARM$INDICE_GLOBAL <- censo2010_AGEBS_FINAL_NARM$pruebaindiceglobal/7

censo2010_AGEBS_FINAL_NARM$rowindex <- 1:nrow(censo2010_AGEBS_FINAL_NARM)

AMCM <- c("09002","09003","09004","09005","09006","09007","09008","09009","09010","09011","09012","09013","09014","09015","09016","09017","13069","15002","15011","15013","15020","15024","15025","15029","15031","15033","15035","15037","15039","15053","15057","15058","15060","15070","15081","15091","15092","15095","15099","15104","15108","15109","15120","15121","15122")
GDL <- c("14039","14070","14097","14098","14101","14120")
MTY <- c("19006",
         "19009",
         "19018",
         "19019",
         "19021",
         "19026",
         "19031",
         "19039",
         "19046",
         "19049",
         "19048"
)
length(MUNICIPIO)
length(c(AMCM,GDL,MTY))
REST <- MUNICIPIO[which(!(MUNICIPIO %in% c(AMCM,GDL,MTY)))]
length(REST)+length(c(AMCM,GDL,MTY))

#AMCM
censo2010_AGEBS_FINAL_NARM_AMCM <- censo2010_AGEBS_FINAL_NARM[which(censo2010_AGEBS_FINAL_NARM$MUN_ID %in% AMCM),]
censo2010_AGEBS_FINAL_NARM_AMCM_ORDERED <- censo2010_AGEBS_FINAL_NARM_AMCM[order(censo2010_AGEBS_FINAL_NARM_AMCM$INDICE_GLOBAL,decreasing =TRUE),]
head(censo2010_AGEBS_FINAL_NARM_AMCM_ORDERED,10)
censo2010_AGEBS_FINAL_NARM_AMCM_ORDERED[which(is.na(censo2010_AGEBS_FINAL_NARM_AMCM_ORDERED$VIVPAR_HAB)),]$VIVPAR_HAB <- 0
censo2010_AGEBS_FINAL_NARM_AMCM_ORDERED$VIVCUMSUM <- cumsum(censo2010_AGEBS_FINAL_NARM_AMCM_ORDERED$VIVPAR_HAB)
sumVIV <- sum(censo2010_AGEBS_FINAL_NARM_AMCM_ORDERED$VIVPAR_HAB)
censo2010_AGEBS_FINAL_NARM_AMCM_ORDERED$PCTVIVCUMSUM <- censo2010_AGEBS_FINAL_NARM_AMCM_ORDERED$VIVCUMSUM/sumVIV
censo2010_AGEBS_FINAL_NARM_AMCM_ORDERED$NSE_num <- 0
censo2010_AGEBS_FINAL_NARM_AMCM_ORDERED$NSE_char <- ""

censo2010_AGEBS_FINAL_NARM_AMCM_ORDERED[which(censo2010_AGEBS_FINAL_NARM_AMCM_ORDERED$PCTVIVCUMSUM <= 0.068),]$NSE_num <- 7 
censo2010_AGEBS_FINAL_NARM_AMCM_ORDERED[which(censo2010_AGEBS_FINAL_NARM_AMCM_ORDERED$PCTVIVCUMSUM <= 0.068),]$NSE_char <- "A/B" 

censo2010_AGEBS_FINAL_NARM_AMCM_ORDERED[which((censo2010_AGEBS_FINAL_NARM_AMCM_ORDERED$PCTVIVCUMSUM > 0.055)&(censo2010_AGEBS_FINAL_NARM_AMCM_ORDERED$PCTVIVCUMSUM <= 0.182)),]$NSE_num <- 6
censo2010_AGEBS_FINAL_NARM_AMCM_ORDERED[which((censo2010_AGEBS_FINAL_NARM_AMCM_ORDERED$PCTVIVCUMSUM > 0.055)&(censo2010_AGEBS_FINAL_NARM_AMCM_ORDERED$PCTVIVCUMSUM <= 0.182)),]$NSE_char <- "C+"

censo2010_AGEBS_FINAL_NARM_AMCM_ORDERED[which((censo2010_AGEBS_FINAL_NARM_AMCM_ORDERED$PCTVIVCUMSUM > 0.182)&(censo2010_AGEBS_FINAL_NARM_AMCM_ORDERED$PCTVIVCUMSUM <= 0.338)),]$NSE_num <- 5
censo2010_AGEBS_FINAL_NARM_AMCM_ORDERED[which((censo2010_AGEBS_FINAL_NARM_AMCM_ORDERED$PCTVIVCUMSUM > 0.182)&(censo2010_AGEBS_FINAL_NARM_AMCM_ORDERED$PCTVIVCUMSUM <= 0.338)),]$NSE_char <- "C"

censo2010_AGEBS_FINAL_NARM_AMCM_ORDERED[which((censo2010_AGEBS_FINAL_NARM_AMCM_ORDERED$PCTVIVCUMSUM > 0.338)&(censo2010_AGEBS_FINAL_NARM_AMCM_ORDERED$PCTVIVCUMSUM <= 0.504)),]$NSE_num <- 4
censo2010_AGEBS_FINAL_NARM_AMCM_ORDERED[which((censo2010_AGEBS_FINAL_NARM_AMCM_ORDERED$PCTVIVCUMSUM > 0.338)&(censo2010_AGEBS_FINAL_NARM_AMCM_ORDERED$PCTVIVCUMSUM <= 0.504)),]$NSE_char <- "C-"

censo2010_AGEBS_FINAL_NARM_AMCM_ORDERED[which((censo2010_AGEBS_FINAL_NARM_AMCM_ORDERED$PCTVIVCUMSUM > 0.504)&(censo2010_AGEBS_FINAL_NARM_AMCM_ORDERED$PCTVIVCUMSUM <= 0.684)),]$NSE_num <- 3
censo2010_AGEBS_FINAL_NARM_AMCM_ORDERED[which((censo2010_AGEBS_FINAL_NARM_AMCM_ORDERED$PCTVIVCUMSUM > 0.504)&(censo2010_AGEBS_FINAL_NARM_AMCM_ORDERED$PCTVIVCUMSUM <= 0.684)),]$NSE_char <- "D+"

censo2010_AGEBS_FINAL_NARM_AMCM_ORDERED[which((censo2010_AGEBS_FINAL_NARM_AMCM_ORDERED$PCTVIVCUMSUM > 0.684)&(censo2010_AGEBS_FINAL_NARM_AMCM_ORDERED$PCTVIVCUMSUM <= 0.915)),]$NSE_num <- 2
censo2010_AGEBS_FINAL_NARM_AMCM_ORDERED[which((censo2010_AGEBS_FINAL_NARM_AMCM_ORDERED$PCTVIVCUMSUM > 0.684)&(censo2010_AGEBS_FINAL_NARM_AMCM_ORDERED$PCTVIVCUMSUM <= 0.915)),]$NSE_char <- "D"

censo2010_AGEBS_FINAL_NARM_AMCM_ORDERED[which((censo2010_AGEBS_FINAL_NARM_AMCM_ORDERED$PCTVIVCUMSUM > 0.915)&(censo2010_AGEBS_FINAL_NARM_AMCM_ORDERED$PCTVIVCUMSUM <= 1)),]$NSE_num <- 1
censo2010_AGEBS_FINAL_NARM_AMCM_ORDERED[which((censo2010_AGEBS_FINAL_NARM_AMCM_ORDERED$PCTVIVCUMSUM > 0.915)&(censo2010_AGEBS_FINAL_NARM_AMCM_ORDERED$PCTVIVCUMSUM <= 1)),]$NSE_char <- "E"

table(censo2010_AGEBS_FINAL_NARM_AMCM_ORDERED$NSE_char)/nrow(censo2010_AGEBS_FINAL_NARM_AMCM_ORDERED)
##Fin AMCM
##GDL
censo2010_AGEBS_FINAL_NARM_GDL <- censo2010_AGEBS_FINAL_NARM[which(censo2010_AGEBS_FINAL_NARM$MUN_ID %in% GDL),]
censo2010_AGEBS_FINAL_NARM_GDL_ORDERED <- censo2010_AGEBS_FINAL_NARM_GDL[order(censo2010_AGEBS_FINAL_NARM_GDL$INDICE_GLOBAL,decreasing =TRUE),]
head(censo2010_AGEBS_FINAL_NARM_GDL_ORDERED,10)
censo2010_AGEBS_FINAL_NARM_GDL_ORDERED[which(is.na(censo2010_AGEBS_FINAL_NARM_GDL_ORDERED$VIVPAR_HAB)),]$VIVPAR_HAB <- 0
censo2010_AGEBS_FINAL_NARM_GDL_ORDERED$VIVCUMSUM <- cumsum(censo2010_AGEBS_FINAL_NARM_GDL_ORDERED$VIVPAR_HAB)
sumVIV <- sum(censo2010_AGEBS_FINAL_NARM_GDL_ORDERED$VIVPAR_HAB)
censo2010_AGEBS_FINAL_NARM_GDL_ORDERED$PCTVIVCUMSUM <- censo2010_AGEBS_FINAL_NARM_GDL_ORDERED$VIVCUMSUM/sumVIV
censo2010_AGEBS_FINAL_NARM_GDL_ORDERED$NSE_num <- 0
censo2010_AGEBS_FINAL_NARM_GDL_ORDERED$NSE_char <- ""

censo2010_AGEBS_FINAL_NARM_GDL_ORDERED[which(censo2010_AGEBS_FINAL_NARM_GDL_ORDERED$PCTVIVCUMSUM <= 0.105),]$NSE_num <- 7 
censo2010_AGEBS_FINAL_NARM_GDL_ORDERED[which(censo2010_AGEBS_FINAL_NARM_GDL_ORDERED$PCTVIVCUMSUM <= 0.105),]$NSE_char <- "A/B" 

censo2010_AGEBS_FINAL_NARM_GDL_ORDERED[which((censo2010_AGEBS_FINAL_NARM_GDL_ORDERED$PCTVIVCUMSUM > 0.105)&(censo2010_AGEBS_FINAL_NARM_GDL_ORDERED$PCTVIVCUMSUM <= 0.277)),]$NSE_num <- 6
censo2010_AGEBS_FINAL_NARM_GDL_ORDERED[which((censo2010_AGEBS_FINAL_NARM_GDL_ORDERED$PCTVIVCUMSUM > 0.105)&(censo2010_AGEBS_FINAL_NARM_GDL_ORDERED$PCTVIVCUMSUM <= 0.277)),]$NSE_char <- "C+"

censo2010_AGEBS_FINAL_NARM_GDL_ORDERED[which((censo2010_AGEBS_FINAL_NARM_GDL_ORDERED$PCTVIVCUMSUM > 0.277)&(censo2010_AGEBS_FINAL_NARM_GDL_ORDERED$PCTVIVCUMSUM <= 0.471)),]$NSE_num <- 5
censo2010_AGEBS_FINAL_NARM_GDL_ORDERED[which((censo2010_AGEBS_FINAL_NARM_GDL_ORDERED$PCTVIVCUMSUM > 0.277)&(censo2010_AGEBS_FINAL_NARM_GDL_ORDERED$PCTVIVCUMSUM <= 0.471)),]$NSE_char <- "C"

censo2010_AGEBS_FINAL_NARM_GDL_ORDERED[which((censo2010_AGEBS_FINAL_NARM_GDL_ORDERED$PCTVIVCUMSUM > 0.471)&(censo2010_AGEBS_FINAL_NARM_GDL_ORDERED$PCTVIVCUMSUM <= 0.648)),]$NSE_num <- 4
censo2010_AGEBS_FINAL_NARM_GDL_ORDERED[which((censo2010_AGEBS_FINAL_NARM_GDL_ORDERED$PCTVIVCUMSUM > 0.471)&(censo2010_AGEBS_FINAL_NARM_GDL_ORDERED$PCTVIVCUMSUM <= 0.648)),]$NSE_char <- "C-"

censo2010_AGEBS_FINAL_NARM_GDL_ORDERED[which((censo2010_AGEBS_FINAL_NARM_GDL_ORDERED$PCTVIVCUMSUM > 0.648)&(censo2010_AGEBS_FINAL_NARM_GDL_ORDERED$PCTVIVCUMSUM <= 0.84)),]$NSE_num <- 3
censo2010_AGEBS_FINAL_NARM_GDL_ORDERED[which((censo2010_AGEBS_FINAL_NARM_GDL_ORDERED$PCTVIVCUMSUM > 0.648)&(censo2010_AGEBS_FINAL_NARM_GDL_ORDERED$PCTVIVCUMSUM <= 0.84)),]$NSE_char <- "D+"

censo2010_AGEBS_FINAL_NARM_GDL_ORDERED[which((censo2010_AGEBS_FINAL_NARM_GDL_ORDERED$PCTVIVCUMSUM > 0.84)&(censo2010_AGEBS_FINAL_NARM_GDL_ORDERED$PCTVIVCUMSUM <= 0.961)),]$NSE_num <- 2
censo2010_AGEBS_FINAL_NARM_GDL_ORDERED[which((censo2010_AGEBS_FINAL_NARM_GDL_ORDERED$PCTVIVCUMSUM > 0.84)&(censo2010_AGEBS_FINAL_NARM_GDL_ORDERED$PCTVIVCUMSUM <= 0.961)),]$NSE_char <- "D"

censo2010_AGEBS_FINAL_NARM_GDL_ORDERED[which((censo2010_AGEBS_FINAL_NARM_GDL_ORDERED$PCTVIVCUMSUM > 0.961)&(censo2010_AGEBS_FINAL_NARM_GDL_ORDERED$PCTVIVCUMSUM <= 1)),]$NSE_num <- 1
censo2010_AGEBS_FINAL_NARM_GDL_ORDERED[which((censo2010_AGEBS_FINAL_NARM_GDL_ORDERED$PCTVIVCUMSUM > 0.961)&(censo2010_AGEBS_FINAL_NARM_GDL_ORDERED$PCTVIVCUMSUM <= 1)),]$NSE_char <- "E"

table(censo2010_AGEBS_FINAL_NARM_GDL_ORDERED$NSE_char)/nrow(censo2010_AGEBS_FINAL_NARM_GDL_ORDERED)
##FINGDL

##MTY
censo2010_AGEBS_FINAL_NARM_MTY <- censo2010_AGEBS_FINAL_NARM[which(censo2010_AGEBS_FINAL_NARM$MUN_ID %in% MTY),]
censo2010_AGEBS_FINAL_NARM_MTY_ORDERED <- censo2010_AGEBS_FINAL_NARM_MTY[order(censo2010_AGEBS_FINAL_NARM_MTY$INDICE_GLOBAL,decreasing =TRUE),]
head(censo2010_AGEBS_FINAL_NARM_MTY_ORDERED,10)
censo2010_AGEBS_FINAL_NARM_MTY_ORDERED[which(is.na(censo2010_AGEBS_FINAL_NARM_MTY_ORDERED$VIVPAR_HAB)),]$VIVPAR_HAB <- 0
censo2010_AGEBS_FINAL_NARM_MTY_ORDERED$VIVCUMSUM <- cumsum(censo2010_AGEBS_FINAL_NARM_MTY_ORDERED$VIVPAR_HAB)
sumVIV <- sum(censo2010_AGEBS_FINAL_NARM_MTY_ORDERED$VIVPAR_HAB)
censo2010_AGEBS_FINAL_NARM_MTY_ORDERED$PCTVIVCUMSUM <- censo2010_AGEBS_FINAL_NARM_MTY_ORDERED$VIVCUMSUM/sumVIV
censo2010_AGEBS_FINAL_NARM_MTY_ORDERED$NSE_num <- 0
censo2010_AGEBS_FINAL_NARM_MTY_ORDERED$NSE_char <- ""

censo2010_AGEBS_FINAL_NARM_MTY_ORDERED[which(censo2010_AGEBS_FINAL_NARM_MTY_ORDERED$PCTVIVCUMSUM <= 0.079),]$NSE_num <- 7 
censo2010_AGEBS_FINAL_NARM_MTY_ORDERED[which(censo2010_AGEBS_FINAL_NARM_MTY_ORDERED$PCTVIVCUMSUM <= 0.079),]$NSE_char <- "A/B" 

censo2010_AGEBS_FINAL_NARM_MTY_ORDERED[which((censo2010_AGEBS_FINAL_NARM_MTY_ORDERED$PCTVIVCUMSUM > 0.079)&(censo2010_AGEBS_FINAL_NARM_MTY_ORDERED$PCTVIVCUMSUM <= 0.247)),]$NSE_num <- 6
censo2010_AGEBS_FINAL_NARM_MTY_ORDERED[which((censo2010_AGEBS_FINAL_NARM_MTY_ORDERED$PCTVIVCUMSUM > 0.079)&(censo2010_AGEBS_FINAL_NARM_MTY_ORDERED$PCTVIVCUMSUM <= 0.247)),]$NSE_char <- "C+"

censo2010_AGEBS_FINAL_NARM_MTY_ORDERED[which((censo2010_AGEBS_FINAL_NARM_MTY_ORDERED$PCTVIVCUMSUM > 0.247)&(censo2010_AGEBS_FINAL_NARM_MTY_ORDERED$PCTVIVCUMSUM <= 0.445)),]$NSE_num <- 5
censo2010_AGEBS_FINAL_NARM_MTY_ORDERED[which((censo2010_AGEBS_FINAL_NARM_MTY_ORDERED$PCTVIVCUMSUM > 0.247)&(censo2010_AGEBS_FINAL_NARM_MTY_ORDERED$PCTVIVCUMSUM <= 0.445)),]$NSE_char <- "C"

censo2010_AGEBS_FINAL_NARM_MTY_ORDERED[which((censo2010_AGEBS_FINAL_NARM_MTY_ORDERED$PCTVIVCUMSUM > 0.445)&(censo2010_AGEBS_FINAL_NARM_MTY_ORDERED$PCTVIVCUMSUM <= 0.627)),]$NSE_num <- 4
censo2010_AGEBS_FINAL_NARM_MTY_ORDERED[which((censo2010_AGEBS_FINAL_NARM_MTY_ORDERED$PCTVIVCUMSUM > 0.445)&(censo2010_AGEBS_FINAL_NARM_MTY_ORDERED$PCTVIVCUMSUM <= 0.627)),]$NSE_char <- "C-"

censo2010_AGEBS_FINAL_NARM_MTY_ORDERED[which((censo2010_AGEBS_FINAL_NARM_MTY_ORDERED$PCTVIVCUMSUM > 0.627)&(censo2010_AGEBS_FINAL_NARM_MTY_ORDERED$PCTVIVCUMSUM <= 0.824)),]$NSE_num <- 3
censo2010_AGEBS_FINAL_NARM_MTY_ORDERED[which((censo2010_AGEBS_FINAL_NARM_MTY_ORDERED$PCTVIVCUMSUM > 0.627)&(censo2010_AGEBS_FINAL_NARM_MTY_ORDERED$PCTVIVCUMSUM <= 0.824)),]$NSE_char <- "D+"

censo2010_AGEBS_FINAL_NARM_MTY_ORDERED[which((censo2010_AGEBS_FINAL_NARM_MTY_ORDERED$PCTVIVCUMSUM > 0.824)&(censo2010_AGEBS_FINAL_NARM_MTY_ORDERED$PCTVIVCUMSUM <= 0.973)),]$NSE_num <- 2
censo2010_AGEBS_FINAL_NARM_MTY_ORDERED[which((censo2010_AGEBS_FINAL_NARM_MTY_ORDERED$PCTVIVCUMSUM > 0.824)&(censo2010_AGEBS_FINAL_NARM_MTY_ORDERED$PCTVIVCUMSUM <= 0.973)),]$NSE_char <- "D"

censo2010_AGEBS_FINAL_NARM_MTY_ORDERED[which((censo2010_AGEBS_FINAL_NARM_MTY_ORDERED$PCTVIVCUMSUM > 0.973)&(censo2010_AGEBS_FINAL_NARM_MTY_ORDERED$PCTVIVCUMSUM <= 1)),]$NSE_num <- 1
censo2010_AGEBS_FINAL_NARM_MTY_ORDERED[which((censo2010_AGEBS_FINAL_NARM_MTY_ORDERED$PCTVIVCUMSUM > 0.973)&(censo2010_AGEBS_FINAL_NARM_MTY_ORDERED$PCTVIVCUMSUM <= 1)),]$NSE_char <- "E"

table(censo2010_AGEBS_FINAL_NARM_MTY_ORDERED$NSE_char)/nrow(censo2010_AGEBS_FINAL_NARM_MTY_ORDERED)
##FINMTY

##REST
censo2010_AGEBS_FINAL_NARM_REST <- censo2010_AGEBS_FINAL_NARM[which(censo2010_AGEBS_FINAL_NARM$MUN_ID %in% REST),]
censo2010_AGEBS_FINAL_NARM_REST_ORDERED <- censo2010_AGEBS_FINAL_NARM_REST[order(censo2010_AGEBS_FINAL_NARM_REST$INDICE_GLOBAL,decreasing =TRUE),]
head(censo2010_AGEBS_FINAL_NARM_REST_ORDERED,10)
censo2010_AGEBS_FINAL_NARM_REST_ORDERED[which(is.na(censo2010_AGEBS_FINAL_NARM_REST_ORDERED$VIVPAR_HAB)),]$VIVPAR_HAB <- 0
censo2010_AGEBS_FINAL_NARM_REST_ORDERED$VIVCUMSUM <- cumsum(censo2010_AGEBS_FINAL_NARM_REST_ORDERED$VIVPAR_HAB)
sumVIV <- sum(censo2010_AGEBS_FINAL_NARM_REST_ORDERED$VIVPAR_HAB)
censo2010_AGEBS_FINAL_NARM_REST_ORDERED$PCTVIVCUMSUM <- censo2010_AGEBS_FINAL_NARM_REST_ORDERED$VIVCUMSUM/sumVIV
censo2010_AGEBS_FINAL_NARM_REST_ORDERED$NSE_num <- 0
censo2010_AGEBS_FINAL_NARM_REST_ORDERED$NSE_char <- ""

censo2010_AGEBS_FINAL_NARM_REST_ORDERED[which(censo2010_AGEBS_FINAL_NARM_REST_ORDERED$PCTVIVCUMSUM <= 0.074),]$NSE_num <- 7 
censo2010_AGEBS_FINAL_NARM_REST_ORDERED[which(censo2010_AGEBS_FINAL_NARM_REST_ORDERED$PCTVIVCUMSUM <= 0.074),]$NSE_char <- "A/B" 

censo2010_AGEBS_FINAL_NARM_REST_ORDERED[which((censo2010_AGEBS_FINAL_NARM_REST_ORDERED$PCTVIVCUMSUM > 0.074)&(censo2010_AGEBS_FINAL_NARM_REST_ORDERED$PCTVIVCUMSUM <= 0.215)),]$NSE_num <- 6
censo2010_AGEBS_FINAL_NARM_REST_ORDERED[which((censo2010_AGEBS_FINAL_NARM_REST_ORDERED$PCTVIVCUMSUM > 0.074)&(censo2010_AGEBS_FINAL_NARM_REST_ORDERED$PCTVIVCUMSUM <= 0.215)),]$NSE_char <- "C+"

censo2010_AGEBS_FINAL_NARM_REST_ORDERED[which((censo2010_AGEBS_FINAL_NARM_REST_ORDERED$PCTVIVCUMSUM > 0.215)&(censo2010_AGEBS_FINAL_NARM_REST_ORDERED$PCTVIVCUMSUM <= 0.401)),]$NSE_num <- 5
censo2010_AGEBS_FINAL_NARM_REST_ORDERED[which((censo2010_AGEBS_FINAL_NARM_REST_ORDERED$PCTVIVCUMSUM > 0.215)&(censo2010_AGEBS_FINAL_NARM_REST_ORDERED$PCTVIVCUMSUM <= 0.401)),]$NSE_char <- "C"

censo2010_AGEBS_FINAL_NARM_REST_ORDERED[which((censo2010_AGEBS_FINAL_NARM_REST_ORDERED$PCTVIVCUMSUM > 0.401)&(censo2010_AGEBS_FINAL_NARM_REST_ORDERED$PCTVIVCUMSUM <= 0.575)),]$NSE_num <- 4
censo2010_AGEBS_FINAL_NARM_REST_ORDERED[which((censo2010_AGEBS_FINAL_NARM_REST_ORDERED$PCTVIVCUMSUM > 0.401)&(censo2010_AGEBS_FINAL_NARM_REST_ORDERED$PCTVIVCUMSUM <= 0.575)),]$NSE_char <- "C-"

censo2010_AGEBS_FINAL_NARM_REST_ORDERED[which((censo2010_AGEBS_FINAL_NARM_REST_ORDERED$PCTVIVCUMSUM > 0.575)&(censo2010_AGEBS_FINAL_NARM_REST_ORDERED$PCTVIVCUMSUM <= 0.764)),]$NSE_num <- 3
censo2010_AGEBS_FINAL_NARM_REST_ORDERED[which((censo2010_AGEBS_FINAL_NARM_REST_ORDERED$PCTVIVCUMSUM > 0.575)&(censo2010_AGEBS_FINAL_NARM_REST_ORDERED$PCTVIVCUMSUM <= 0.764)),]$NSE_char <- "D+"

censo2010_AGEBS_FINAL_NARM_REST_ORDERED[which((censo2010_AGEBS_FINAL_NARM_REST_ORDERED$PCTVIVCUMSUM > 0.764)&(censo2010_AGEBS_FINAL_NARM_REST_ORDERED$PCTVIVCUMSUM <= 0.947)),]$NSE_num <- 2
censo2010_AGEBS_FINAL_NARM_REST_ORDERED[which((censo2010_AGEBS_FINAL_NARM_REST_ORDERED$PCTVIVCUMSUM > 0.764)&(censo2010_AGEBS_FINAL_NARM_REST_ORDERED$PCTVIVCUMSUM <= 0.947)),]$NSE_char <- "D"

censo2010_AGEBS_FINAL_NARM_REST_ORDERED[which((censo2010_AGEBS_FINAL_NARM_REST_ORDERED$PCTVIVCUMSUM > 0.947)&(censo2010_AGEBS_FINAL_NARM_REST_ORDERED$PCTVIVCUMSUM <= 1)),]$NSE_num <- 1
censo2010_AGEBS_FINAL_NARM_REST_ORDERED[which((censo2010_AGEBS_FINAL_NARM_REST_ORDERED$PCTVIVCUMSUM > 0.947)&(censo2010_AGEBS_FINAL_NARM_REST_ORDERED$PCTVIVCUMSUM <= 1)),]$NSE_char <- "E"

table(censo2010_AGEBS_FINAL_NARM_REST_ORDERED$NSE_char)/nrow(censo2010_AGEBS_FINAL_NARM_REST_ORDERED)
##FINREST
censo2010_AGEBS_FINAL_NARM_ORDERED <- rbind(censo2010_AGEBS_FINAL_NARM_AMCM_ORDERED,censo2010_AGEBS_FINAL_NARM_GDL_ORDERED,censo2010_AGEBS_FINAL_NARM_MTY_ORDERED,censo2010_AGEBS_FINAL_NARM_REST_ORDERED)
sum(censo2010_AGEBS_FINAL_NARM_ORDERED$POBTOT)
sum(censo2010_AGEBS_FINAL_NARM$POBTOT)
nrow(censo2010_AGEBS_FINAL_NARM_ORDERED)
nrow(censo2010_AGEBS_FINAL_NARM)
censo2010_AGEBS_FINAL_NARM[which(!(censo2010_AGEBS_FINAL_NARM$AGEB_ID %in% censo2010_AGEBS_FINAL_NARM_ORDERED$AGEB_ID)),]$AGEB_ID
##ANterior
# 
# censo2010_AGEBS_FINAL_NARM_ORDERED <- censo2010_AGEBS_FINAL_NARM[order(censo2010_AGEBS_FINAL_NARM$INDICE_GLOBAL,decreasing =TRUE),]
# 
# head(censo2010_AGEBS_FINAL_NARM_ORDERED,10)
# 
# censo2010_AGEBS_FINAL_NARM_ORDERED[which(is.na(censo2010_AGEBS_FINAL_NARM_ORDERED$VIVPAR_HAB)),]$VIVPAR_HAB <- 0
# 
# censo2010_AGEBS_FINAL_NARM_ORDERED$VIVCUMSUM <- cumsum(censo2010_AGEBS_FINAL_NARM_ORDERED$VIVPAR_HAB)
# sumVIV <- sum(censo2010_AGEBS_FINAL_NARM_ORDERED$VIVPAR_HAB)
# censo2010_AGEBS_FINAL_NARM_ORDERED$PCTVIVCUMSUM <- censo2010_AGEBS_FINAL_NARM_ORDERED$VIVCUMSUM/sumVIV
# 
# censo2010_AGEBS_FINAL_NARM_ORDERED$NSE_num <- 0
# censo2010_AGEBS_FINAL_NARM_ORDERED$NSE_char <- ""
# 6.8+14.2+17+17.1+18.5+21.4+
# 
# censo2010_AGEBS_FINAL_NARM_ORDERED[which(censo2010_AGEBS_FINAL_NARM_ORDERED$PCTVIVCUMSUM <= 0.068),]$NSE_num <- 7 
# censo2010_AGEBS_FINAL_NARM_ORDERED[which(censo2010_AGEBS_FINAL_NARM_ORDERED$PCTVIVCUMSUM <= 0.068),]$NSE_char <- "A/B" 
# 
# censo2010_AGEBS_FINAL_NARM_ORDERED[which((censo2010_AGEBS_FINAL_NARM_ORDERED$PCTVIVCUMSUM > 0.068)&(censo2010_AGEBS_FINAL_NARM_ORDERED$PCTVIVCUMSUM <= 0.21)),]$NSE_num <- 6
# censo2010_AGEBS_FINAL_NARM_ORDERED[which((censo2010_AGEBS_FINAL_NARM_ORDERED$PCTVIVCUMSUM > 0.068)&(censo2010_AGEBS_FINAL_NARM_ORDERED$PCTVIVCUMSUM <= 0.21)),]$NSE_char <- "C+"
# 
# censo2010_AGEBS_FINAL_NARM_ORDERED[which((censo2010_AGEBS_FINAL_NARM_ORDERED$PCTVIVCUMSUM > 0.21)&(censo2010_AGEBS_FINAL_NARM_ORDERED$PCTVIVCUMSUM <= 0.38)),]$NSE_num <- 5
# censo2010_AGEBS_FINAL_NARM_ORDERED[which((censo2010_AGEBS_FINAL_NARM_ORDERED$PCTVIVCUMSUM > 0.21)&(censo2010_AGEBS_FINAL_NARM_ORDERED$PCTVIVCUMSUM <= 0.38)),]$NSE_char <- "C"
# 
# censo2010_AGEBS_FINAL_NARM_ORDERED[which((censo2010_AGEBS_FINAL_NARM_ORDERED$PCTVIVCUMSUM > 0.38)&(censo2010_AGEBS_FINAL_NARM_ORDERED$PCTVIVCUMSUM <= 0.551)),]$NSE_num <- 4
# censo2010_AGEBS_FINAL_NARM_ORDERED[which((censo2010_AGEBS_FINAL_NARM_ORDERED$PCTVIVCUMSUM > 0.38)&(censo2010_AGEBS_FINAL_NARM_ORDERED$PCTVIVCUMSUM <= 0.551)),]$NSE_char <- "C-"
# 
# censo2010_AGEBS_FINAL_NARM_ORDERED[which((censo2010_AGEBS_FINAL_NARM_ORDERED$PCTVIVCUMSUM > 0.551)&(censo2010_AGEBS_FINAL_NARM_ORDERED$PCTVIVCUMSUM <= 0.736)),]$NSE_num <- 3
# censo2010_AGEBS_FINAL_NARM_ORDERED[which((censo2010_AGEBS_FINAL_NARM_ORDERED$PCTVIVCUMSUM > 0.551)&(censo2010_AGEBS_FINAL_NARM_ORDERED$PCTVIVCUMSUM <= 0.736)),]$NSE_char <- "D+"
# 
# censo2010_AGEBS_FINAL_NARM_ORDERED[which((censo2010_AGEBS_FINAL_NARM_ORDERED$PCTVIVCUMSUM > 0.736)&(censo2010_AGEBS_FINAL_NARM_ORDERED$PCTVIVCUMSUM <= 0.95)),]$NSE_num <- 2
# censo2010_AGEBS_FINAL_NARM_ORDERED[which((censo2010_AGEBS_FINAL_NARM_ORDERED$PCTVIVCUMSUM > 0.736)&(censo2010_AGEBS_FINAL_NARM_ORDERED$PCTVIVCUMSUM <= 0.95)),]$NSE_char <- "D"
# 
# censo2010_AGEBS_FINAL_NARM_ORDERED[which((censo2010_AGEBS_FINAL_NARM_ORDERED$PCTVIVCUMSUM > 0.95)&(censo2010_AGEBS_FINAL_NARM_ORDERED$PCTVIVCUMSUM <= 1)),]$NSE_num <- 1
# censo2010_AGEBS_FINAL_NARM_ORDERED[which((censo2010_AGEBS_FINAL_NARM_ORDERED$PCTVIVCUMSUM > 0.95)&(censo2010_AGEBS_FINAL_NARM_ORDERED$PCTVIVCUMSUM <= 1)),]$NSE_char <- "E"
# 
# table(censo2010_AGEBS_FINAL_NARM_ORDERED$NSE_char)/nrow(censo2010_AGEBS_FINAL_NARM_ORDERED)
# 
# str(censo2010_AGEBS_FINAL_NARM_ORDERED)


##Juntarlas de nuevo
names(censo2010_AGEBS_FINAL_NARM_ORDERED)
which(censo2010_AGEBS_FINAL_NARM_MTY_ORDERED$MUN_ID == "19049")
censo2010_AGEBS_FINAL_NARM_ORDERED_REORDERED <- censo2010_AGEBS_FINAL_NARM_ORDERED[,c(25,37,1,3,5,7,2,4,8,9,10,11,14,16,20,21,22,23,24,36,40,41)]
censo2010_AGEBS_FINAL_NARM_ORDERED_REORDERED <- censo2010_AGEBS_FINAL_NARM_ORDERED_REORDERED[order(censo2010_AGEBS_FINAL_NARM_ORDERED_REORDERED$rowindex),]

# censo2010_AGEBS_FINAL_NARM_ORDERED_REORDERED
sumvivparhab <- sum(censo2010_AGEBS_FINAL_NARM_ORDERED_REORDERED$VIVPAR_HAB)
vivparhab_NSE <- sapply(by(censo2010_AGEBS_FINAL_NARM_ORDERED_REORDERED$VIVPAR_HAB,censo2010_AGEBS_FINAL_NARM_ORDERED_REORDERED$NSE_num,sum),rbind)
vivparhab_NSE/sumvivparhab
# 
# ?by
# censo2010_AGEBS_FINAL_NARM_ORDERED_REORDERED

nrow(censo2010_AGEBS_FINAL_NARM_ORDERED_REORDERED)
# ?write.csv
write.csv(censo2010_AGEBS_FINAL_NARM_ORDERED_REORDERED,"NSE_AGEB.csv",row.names = FALSE)
names(censo2010_AGEBS_FINAL_NARM_ORDERED_REORDERED)
write.csv(censo2010_AGEBS_FINAL_NARM_ORDERED_REORDERED[,c(1,21,22)],"NSE_AGEB_MB.csv",row.names = FALSE)

rowtype <- sapply(censo2010_AGEBS_FINAL_NARM_ORDERED_REORDERED,class)
rowtype[rowtype == "character"] <- "String"
rowtype[rowtype == "integer"] <- "Integer"
rowtype[rowtype == "numeric"] <- "Real"
?gsub
gsub("\\","",paste(rowtype,collapse="\",\""))
write.csv(rowtype,"NSE_AGEB.csvt",row.names = FALSE)
?write.csv
summary(censo2010_AGEBS_FINAL_NARM$INDICE_GLOBAL)

censo2010_AGEBS_FINAL_NARM$

censo2010_AGEBS_FINAL[which(censo2010_AGEBS_FINAL$PROMCUARTOS > 16),]$AGEB_ID
?max
?order
?drop


cor(censo2010_AGEBS_FINAL[,c(23,24,25)], use="complete.obs")
cov(censo2010_AGEBS_FINAL[,c(23,24,25)], use="complete.obs")

var(censo2010_AGEBS_FINAL$Indice_PC,na.rm = TRUE)
?var
princomp(censo2010_AGEBS_FINAL[which(complete.cases(censo2010_AGEBS_FINAL[,c(23,24,25)])),c(23,24,25)])
prcomp(censo2010_AGEBS_FINAL[which(complete.cases(censo2010_AGEBS_FINAL[,c(23,24,25)])),c(23,24,25)])
plot(prcomp(censo2010_AGEBS_FINAL[which(complete.cases(censo2010_AGEBS_FINAL[,c(23,24,25)])),c(23,24,25)]))
summary(PC)
PC$rotation[,1]
scores <- predict(PC)
str(scores[,1])
?prcomp


paste()
table(as.numeric(agscenso2010_AGEBS$GRAPROES))
summary(as.numeric(agscenso2010_AGEBS$GRAPROES))
hist(as.numeric(agscenso2010_AGEBS$GRAPROES))
agscenso2010_AGEBS$PROMCUARTOS <- agscenso2010_AGEBS$PROM_OCUP/agscenso2010_AGEBS$PRO_OCUP_C
summary(agscenso2010_AGEBS$PROMCUARTOS)
par(mfcol = c(1,1))
hist(agscenso2010_AGEBS$PROMCUARTOS)
hist(agscenso2010_AGEBS$PROM_OCUP)
hist(agscenso2010_AGEBS$PRO_OCUP_C)
